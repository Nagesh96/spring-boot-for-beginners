name: Build and Deploy Java Application

on:
 push:
  branches:
   - main

jobs:
 build-deploy:
  name: Build and Deploy Java Application
  runs-on: ubuntu-latest
  steps:
   - name: checkout code
     uses: actions/checkout@v3

   - name: setup JDK 17
     uses: actions/setup-java@v3
     with:
      distribution: 'corretto'
      java-version: 17

   - name: Unit Tests
     run: mvn test

   - name: Build the Application
     run: mvn clean package
     
   - name: Code Analysis
     uses: actions/checkout@master
     with:
        # Disabling shallow clone is recommended for improving relevancy of reporting
      fetch-depth: 0
   - name: SonarQube Scan
     uses: kitabisa/sonarqube-action@v1.2.0
     with:
      host: ${{ secrets.SONAR_HOST_URL }}
      login: ${{ secrets.SONAR_TOKEN }}
      projectKey: spring-boot-app
